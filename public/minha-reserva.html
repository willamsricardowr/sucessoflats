<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Minha reserva — Sucesso Flat’s</title>
  <meta name="theme-color" content="#C9A44A" />
  <link rel="icon" href="/public/logo-sucesso.png" />
  <style>
    :root{
      --gold:#C9A44A; --bronze:#B87333; --ink:#0F172A; --muted:#64748B;
      --bg:#F7F7F9; --card:#fff; --border:#E5E7EB; --radius:14px; --shadow:0 6px 24px rgba(2,6,23,.08)
    }
    *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
    .wrap{max-width:720px;margin:32px auto;padding:0 16px}
    .card{background:var(--card);border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow);padding:20px}
    .row{display:flex;gap:16px;flex-wrap:wrap}
    .row>div{flex:1 1 260px}
    .btn{display:inline-block;background:linear-gradient(90deg,var(--gold),var(--bronze));color:#fff;font-weight:700;padding:12px 18px;border-radius:10px;text-decoration:none}
    .muted{color:var(--muted)} .sp{height:12px}
    header{display:flex;align-items:center;gap:12px;margin-bottom:16px}
    header img{width:160px;height:auto}
    .error{padding:16px;border-radius:12px;background:#fff3f0;border:1px solid #ffd5cc;color:#7a2e11}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <a href="/"><img src="/public/logo-sucesso.png" alt="Sucesso Flat’s" /></a>
      <div class="muted">Minha reserva</div>
    </header>

    <div id="view" class="card">Carregando…</div>
  </div>

  <script>
    async function main(){
      const box = document.getElementById('view');
      const p = new URLSearchParams(location.search);
      const id = p.get('id');
      if(!id){ box.innerHTML = '<div class="error">ID da reserva não informado.</div>'; return; }

      try{
        const r = await fetch(`/api/reservas/get?id=${encodeURIComponent(id)}`);
        const json = await r.json();
        if(!r.ok){ throw new Error(json?.error || 'Falha ao buscar'); }
        const rsv = json;

        box.innerHTML = `
          <h1 style="margin:0 0 6px 0;">Reserva #${rsv.id}</h1>
          <p class="muted" style="margin:0 0 16px 0">Status: <strong>${rsv.status}</strong></p>

          <div class="row">
            <div>
              <div class="muted">Hóspede</div>
              <div><strong>${rsv.hospede_nome || '-'}</strong><br>${rsv.hospede_email || '-'}</div>
            </div>
            <div>
              <div class="muted">Flat</div>
              <div><strong>${rsv.flat_slug}</strong></div>
            </div>
          </div>

          <div class="sp"></div>

          <div class="row">
            <div>
              <div class="muted">Período</div>
              <div><strong>${rsv.checkin}</strong> → <strong>${rsv.checkout}</strong></div>
              <div class="muted">Check-in 14:00 • Check-out 12:00</div>
            </div>
            <div>
              <div class="muted">Total</div>
              <div><strong>R$ ${Number(rsv.total||0).toFixed(2)}</strong></div>
            </div>
          </div>

          <div class="sp"></div>
          <a class="btn" href="mailto:sucessoflats@gmail.com?subject=Minha%20reserva%20${encodeURIComponent(rsv.id)}">Falar com a equipe</a>
          <a class="btn" style="margin-left:8px" href="https://wa.me/5586981750070?text=Olá!%20Minha%20reserva%20é%20${encodeURIComponent(rsv.id)}" target="_blank" rel="noopener">WhatsApp</a>
        `;
      }catch(e){
        box.innerHTML = `<div class="error">Não foi possível carregar a reserva. ${e.message}</div>`;
      }
    }
    main();
  </script>
</body>
</html>
